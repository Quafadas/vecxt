package build.vecxt

import mill.*, scalalib.*, scalajslib.*, publish.*
import mill.scalajslib.api.ModuleKind
import com.goyeau.mill.scalafix.ScalafixModule
import mill.api.Task.Simple


object `package` extends Module {
  trait VecxtModule extends PlatformScalaModule with build.VecxtPublishModule  {
    def mvnDeps = super.mvnDeps() ++ Seq(
      build.V.narr
    )
    trait VecxtTest extends ScalaTests, TestModule.Munit   {
      def mvnDeps = super.mvnDeps() ++ Seq(
        mvn"org.scalameta::munit::${build.V.munitVersion}",
      )
      override def forkArgs: Simple[Seq[String]] = super.forkArgs() ++ build.vecIncubatorFlag
    }
  }



  object jvm extends VecxtModule {
    override def scalaVersion = build.V.scalaVersion
    override def forkArgs = super.forkArgs() ++ build.vecIncubatorFlag
    def mvnDeps = super.mvnDeps() ++ Seq(
      mvn"dev.ludovic.netlib:blas:3.0.4"
    )

    object test extends VecxtTest, ScalaTests {
      def moduleDeps = Seq(jvm)
      override def forkArgs: Simple[Seq[String]] = super.forkArgs() ++ build.vecIncubatorFlag
    }
  }
  object js extends VecxtModule with build.CommonJS {
    override def mvnDeps = super.mvnDeps()
    def moduleKind = ModuleKind.ESModule
    object test extends VecxtTest, ScalaJSTests {
      def moduleDeps = Seq(js)
      def moduleKind = ModuleKind.CommonJSModule
    }
  }
  object native extends VecxtModule with build.CommonNative {
    override def mvnDeps = super.mvnDeps()

    object test extends ScalaNativeTests, VecxtTest {
      override def moduleDeps = Seq(native)
    }
  }
}