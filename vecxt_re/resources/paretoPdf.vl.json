{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "description": "Pareto PDF with correctly normalized log-binned histogram and analytic overlay",
  "width": 600,
  "height": 300,

  "layer": [
    {
      "data": {
        "values": [
          { "x": 1.02 }, { "x": 1.05 }, { "x": 1.08 }, { "x": 1.10 },
          { "x": 1.15 }, { "x": 1.20 }, { "x": 1.25 }, { "x": 1.30 },
          { "x": 1.40 }, { "x": 1.50 }, { "x": 1.70 }, { "x": 1.90 },
          { "x": 2.10 }, { "x": 2.40 }, { "x": 2.80 }, { "x": 3.20 },
          { "x": 3.80 }, { "x": 4.50 }, { "x": 5.30 }, { "x": 6.20 },
          { "x": 7.50 }, { "x": 9.00 }, { "x": 11.0 }, { "x": 14.0 },
          { "x": 18.0 }
        ]
      },

      "transform": [
        {
          "calculate": "log(datum.x)",
          "as": "logx"
        },
        {
          "bin": { "maxbins": 25 },
          "field": "logx",
          "as": ["logx0", "logx1"]
        },
        {
          "aggregate": [
            { "op": "count", "as": "count" }
          ],
          "groupby": ["logx0", "logx1"]
        },
        {
          "joinaggregate": [
            { "op": "sum", "field": "count", "as": "N" }
          ]
        },
        {
          "calculate": "exp(datum.logx0)",
          "as": "x0"
        },
        {
          "calculate": "exp(datum.logx1)",
          "as": "x1"
        },
        {
          "calculate": "datum.count / (datum.N * (datum.x1 - datum.x0))",
          "as": "density"
        }
      ],

      "mark": {
        "type": "bar",
        "opacity": 0.6
      },

      "encoding": {
        "x": {
          "field": "x0",
          "type": "quantitative",
          "scale": { "type": "log" },
          "title": "x"
        },
        "x2": {
          "field": "x1"
        },
        "y": {
          "field": "density",
          "type": "quantitative",
          "title": "PDF"
        },
        "tooltip": [
          { "field": "count", "type": "quantitative", "title": "Count" },
          { "field": "density", "type": "quantitative", "title": "Density" }
        ]
      }
    },

    {
      "data": {
        "sequence": {
          "start": 1,
          "stop": 20,
          "step": 0.05
        }
      },

      "transform": [
        {
          "calculate": "2 * pow(datum.data, -3)",
          "as": "pdf"
        }
      ],

      "mark": {
        "type": "line",
        "strokeWidth": 2
      },

      "encoding": {
        "x": {
          "field": "data",
          "type": "quantitative",
          "scale": { "type": "log" }
        },
        "y": {
          "field": "pdf",
          "type": "quantitative"
        }
      }
    }
  ]
}